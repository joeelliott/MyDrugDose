<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pediatric Dose Calculator (Joe's Private Use)</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1.5rem;
      background: #020617;
      color: #e5e7eb;
    }
    h1, h2 {
      margin: 0 0 0.5rem;
    }
    .card {
      background: #020617;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      border: 1px solid #1e293b;
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin-bottom: 0.35rem;
      font-size: 0.9rem;
    }
    input, select {
      width: 100%;
      padding: 0.4rem 0.55rem;
      border-radius: 0.5rem;
      border: 1px solid #1f2933;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }
    input:focus, select:focus {
      outline: 2px solid #22c55e;
      outline-offset: 1px;
    }
    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem;
    }
    button {
      margin-top: 0.5rem;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.95rem;
    }
    button:hover {
      filter: brightness(1.05);
    }
    button:active {
      transform: translateY(1px);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.75rem;
      font-size: 0.85rem;
    }
    th, td {
      padding: 0.45rem 0.4rem;
      border-bottom: 1px solid #1e293b;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #020617;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .protocol {
      font-weight: 600;
      color: #a855f7;
    }
    .drug-name {
      font-weight: 600;
      color: #e5e7eb;
    }
    .note {
      color: #9ca3af;
    }
    .muted {
      color: #64748b;
      font-size: 0.8rem;
    }
    .chip {
      display: inline-block;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      background: #0f172a;
      border: 1px solid #1e293b;
      font-size: 0.7rem;
      margin-right: 0.25rem;
      color: #cbd5f5;
    }
    .scroll {
      max-height: 65vh;
      overflow: auto;
      border-radius: 0.75rem;
      border: 1px solid #1e293b;
    }
    @media (max-width: 640px) {
      body { padding: 0.75rem; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Pediatric Dose Calculator</h1>
    <p class="muted">
      Always cross-check doses in the source protocol.
    </p>
    <div class="row">
      <div>
        <label for="weightKg">Weight (kg)</label>
        <input id="weightKg" type="number" min="0" step="0.01" value="20">
      </div>
      <div>
        <label for="ageYears">Age (years)</label>
        <input id="ageYears" type="number" min="0" step="0.1" value="5">
      </div>
      <div>
        <label for="protocolFilter">Filter by protocol (optional)</label>
        <select id="protocolFilter">
          <option value="all">All pediatric protocols</option>
        </select>
      </div>
    </div>
    <button onclick="calculateDoses()">Calculate doses</button>
  </div>

  <div class="card">
    <h2>Calculated Doses</h2>
    <p id="summary" class="muted"></p>
    <div class="scroll">
      <table>
        <thead>
          <tr>
            <th style="width: 18%;">Protocol</th>
            <th style="width: 22%;">Drug</th>
            <th style="width: 35%;">Dose for this patient</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
      </table>
    </div>
  </div>

<script>
/*
  Pediatric drug/fluids encoded from the Pediatric Protocols section
  of the "Neonatal and Pediatric Flow Charts [2023]" booklet.

  This file is for private, educational/self-use only.
*/

// helper: standard pediatric MIVF 4–2–1 rule (mL/hr)
function mivfRate(weightKg) {
  const w = Math.max(0, weightKg);
  const first10 = Math.min(w, 10);
  const second10 = Math.min(Math.max(w - 10, 0), 10);
  const remaining = Math.max(w - 20, 0);
  return first10 * 4 + second10 * 2 + remaining * 1;
}

const drugs = [
  // --- Altered Mental Status ---
  {
    protocol: "Pediatric Altered Mental Status",
    id: "peds_ams_d10",
    name: "D10W bolus",
    route: "IV",
    tags: ["bolus", "glucose"],
    calc(weightKg) {
      const mlPerKg = 5;
      const max = 100;
      const vol = Math.min(weightKg * mlPerKg, max);
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL (max 100 mL).`;
    },
    note: "Used when glucose < threshold and altered mental status."
  },
  {
    protocol: "Pediatric Altered Mental Status",
    id: "peds_ams_hts_seizure",
    name: "3% Hypertonic Saline (seizure hyponatremia)",
    route: "IV",
    tags: ["bolus", "hypertonic"],
    calc(weightKg) {
      const mlPerKg = 3;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL for Na <130 & actively seizing.`;
    },
    note: "Treats symptomatic hyponatremic seizures."
  },
  {
    protocol: "Pediatric Altered Mental Status",
    id: "peds_ams_hts_icp",
    name: "3% Hypertonic Saline (ICP concern)",
    route: "IV push",
    tags: ["bolus", "hypertonic"],
    calc(weightKg) {
      const mlPerKg = 5;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL IV push for concern of ↑ICP.`;
    },
    note: "Use when signs of increased intracranial pressure present."
  },

  // --- Anaphylaxis ---
  {
    protocol: "Pediatric Anaphylaxis",
    id: "peds_ana_epi_im",
    name: "Epinephrine 1:1000",
    route: "IM",
    tags: ["bolus"],
    calc(weightKg) {
      const mgPerKg = 0.01;
      const maxMg = 0.3;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(3)} mg (max 0.3 mg).`;
    },
    note: "First-line treatment; may repeat per protocol."
  },
  {
    protocol: "Pediatric Anaphylaxis",
    id: "peds_ana_diphen",
    name: "Diphenhydramine",
    route: "IV/IM",
    tags: ["antihistamine"],
    calc(weightKg) {
      const mgPerKg = 1;
      const maxMg = 50;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg (max 50 mg).`;
    },
    note: "Adjunct after epinephrine."
  },
  {
    protocol: "Pediatric Anaphylaxis",
    id: "peds_ana_dexa",
    name: "Dexamethasone",
    route: "IV/PO",
    tags: ["steroid"],
    calc(weightKg) {
      const mgPerKg = 0.6;
      const maxMg = 16;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 16 mg).`;
    },
    note: "Steroid for late-phase reaction."
  },
  {
    protocol: "Pediatric Anaphylaxis",
    id: "peds_ana_albuterol",
    name: "Albuterol neb",
    route: "Nebulized",
    tags: ["bronchodilator"],
    calc() {
      return `2.5 mg in 3 mL NS (fixed neb dose).`;
    },
    note: "For bronchospasm associated with anaphylaxis."
  },

  // --- Asthma ---
  {
    protocol: "Pediatric Asthma",
    id: "peds_asth_mag",
    name: "Magnesium sulfate",
    route: "IV",
    tags: ["bronchodilator"],
    calc(weightKg) {
      const mgPerKg = 75;
      const maxMg = 2000;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      const grams = mg / 1000;
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg (≈ ${grams.toFixed(2)} g, max 2 g).`;
    },
    note: "Single IV dose for severe asthma exacerbation."
  },
  {
    protocol: "Pediatric Asthma",
    id: "peds_asth_decadron",
    name: "Dexamethasone (Decadron)",
    route: "PO/IV",
    tags: ["steroid"],
    calc(weightKg) {
      const mgPerKg = 0.6;
      const maxMg = 16;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 16 mg).`;
    },
    note: "Give when patient stabilized if no prior steroid given."
  },
  {
    protocol: "Pediatric Asthma",
    id: "peds_asth_terb",
    name: "Terbutaline",
    route: "SQ/IV (per protocol)",
    tags: ["bronchodilator"],
    calc(weightKg) {
      const mgPerKg = 0.01;
      const maxMg = 0.4;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(3)} mg (max 0.4 mg).`;
    },
    note: "Route & repeat interval per institutional protocol."
  },
  {
    protocol: "Pediatric Asthma",
    id: "peds_asth_epi_im",
    name: "Epinephrine",
    route: "IM",
    tags: ["bronchodilator"],
    calc(weightKg) {
      const mgPerKg = 0.01;
      const maxMg = 0.3;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(3)} mg (max 0.3 mg).`;
    },
    note: "Consider in severe asthma with impending respiratory failure."
  },
  {
    protocol: "Pediatric Asthma",
    id: "peds_asth_ketamine_bolus",
    name: "Ketamine (BIPAP only)",
    route: "IV",
    tags: ["bolus", "sedation"],
    calc(weightKg) {
      const low = 0.5 * weightKg;
      const high = 1.0 * weightKg;
      return `0.5–1 mg/kg → ${low.toFixed(2)}–${high.toFixed(2)} mg bolus.`;
    },
    note: "Requires BIPAP and medical control."
  },
  {
    protocol: "Pediatric Asthma",
    id: "peds_asth_ketamine_inf",
    name: "Ketamine infusion (BIPAP only)",
    route: "IV infusion",
    tags: ["infusion", "sedation"],
    calc(weightKg) {
      const low = 1 * weightKg;
      const high = 2 * weightKg;
      return `1–2 mg/kg/hr → ${low.toFixed(2)}–${high.toFixed(2)} mg/hr.`;
    },
    note: "Begin after bolus if directed by medical control."
  },

  // --- Beta / Calcium Channel Blocker Overdose ---
  {
    protocol: "Peds Beta/Calcium Blocker OD",
    id: "peds_bccb_epi_drip",
    name: "Epinephrine infusion",
    route: "IV infusion",
    tags: ["pressor"],
    calc(weightKg) {
      const low = 0.05 * weightKg;
      const high = 0.5 * weightKg;
      return `0.05–0.5 mcg/kg/min → ${low.toFixed(3)}–${high.toFixed(3)} mcg/min.`;
    },
    note: "Titrate to hemodynamics per protocol."
  },
  {
    protocol: "Peds Beta/Calcium Blocker OD",
    id: "peds_bccb_glucagon_bolus",
    name: "Glucagon bolus",
    route: "IV",
    tags: ["inotrope"],
    calc(weightKg) {
      const mgPerKg = 0.15;
      const maxMg = 5;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 5 mg) over 10 min.`;
    },
    note: "Initial bolus for beta/calcium channel blocker overdose."
  },
  {
    protocol: "Peds Beta/Calcium Blocker OD",
    id: "peds_bccb_glucagon_inf",
    name: "Glucagon infusion",
    route: "IV infusion",
    tags: ["inotrope"],
    calc(weightKg) {
      const low = 0.05 * weightKg;
      const high = 0.1 * weightKg;
      const max = 3;
      const lowAdj = Math.min(low, max);
      const highAdj = Math.min(high, max);
      return `0.05–0.1 mg/kg/hr → ${lowAdj.toFixed(2)}–${highAdj.toFixed(2)} mg/hr (max 3 mg/hr).`;
    },
    note: "After initial bolus if ongoing support needed."
  },
  {
    protocol: "Peds Beta/Calcium Blocker OD",
    id: "peds_bccb_insulin_bolus",
    name: "Insulin regular bolus",
    route: "IV push",
    tags: ["bolus"],
    calc(weightKg) {
      const unitsPerKg = 0.1;
      const maxUnits = 10;
      const units = Math.min(weightKg * unitsPerKg, maxUnits);
      return `${unitsPerKg} unit/kg → ${units.toFixed(2)} units (max 10 units).`;
    },
    note: "High-dose insulin therapy; requires dextrose support."
  },
  {
    protocol: "Peds Beta/Calcium Blocker OD",
    id: "peds_bccb_d25",
    name: "D25W",
    route: "IV push",
    tags: ["glucose"],
    calc(weightKg) {
      const mlPerKg = 2;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL IVP.`;
    },
    note: "Supportive dextrose for high-dose insulin therapy."
  },
  {
    protocol: "Peds Beta/Calcium Blocker OD",
    id: "peds_bccb_caglu",
    name: "Calcium gluconate",
    route: "IV",
    tags: ["calcium"],
    calc(weightKg) {
      const mgPerKg = 60;
      const maxMg = 3000;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      const mlApprox = mg / 100; // rough approx 100 mg/mL
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg (max 3000 mg, ~${mlApprox.toFixed(1)} mL of 100 mg/mL).`;
    },
    note: "For calcium channel blocker toxicity and hypotension."
  },

  // --- Bronchiolitis ---
  {
    protocol: "Pediatric Bronchiolitis",
    id: "peds_bronch_ns_bolus",
    name: "Normal saline bolus",
    route: "IV",
    tags: ["bolus", "fluid"],
    calc(weightKg) {
      const mlPerKg = 20;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL.`;
    },
    note: "Initial fluid bolus for dehydration/shock."
  },
  {
    protocol: "Pediatric Bronchiolitis",
    id: "peds_bronch_mivf",
    name: "Maintenance fluid (4–2–1 rule)",
    route: "IV infusion",
    tags: ["maintenance"],
    calc(weightKg) {
      const rate = mivfRate(weightKg);
      const max = 150;
      const adjRate = Math.min(rate, max);
      return `Rate = ${rate.toFixed(1)} mL/hr (capped at ${max} mL/hr → ${adjRate.toFixed(1)} mL/hr).`;
    },
    note: "First 10 kg ×4, second 10 kg ×2, each kg >20 ×1; max 150 mL/hr."
  },

  // --- Burn ---
  {
    protocol: "Pediatric Burn",
    id: "peds_burn_lr_major",
    name: "LR resuscitation for major burns",
    route: "IV",
    tags: ["fluid"],
    calc(weightKg, ageYears) {
      // From protocol: age-based LR rates for large burns
      let mlHr;
      if (ageYears < 6) mlHr = 125;
      else if (ageYears < 14) mlHr = 250;
      else mlHr = 500;
      return `${mlHr} mL/hr LR for major burns (>15% TBSA) based on age.`;
    },
    note: "Add D5NS at maintenance rate for patients <30 kg."
  },
  {
    protocol: "Pediatric Burn",
    id: "peds_burn_goal_uop",
    name: "Goal urine output",
    route: "Monitoring",
    tags: ["target"],
    calc(weightKg, ageYears) {
      if (ageYears >= 14 && weightKg > 40) {
        return `Goal UOP: 30 mL/hr.`;
      } else {
        const mlPerKgHr = 1;
        const mlHr = weightKg * mlPerKgHr;
        return `Goal UOP: ${mlPerKgHr} mL/kg/hr → ${mlHr.toFixed(1)} mL/hr.`;
      }
    },
    note: "Used to titrate fluid resuscitation."
  },

  // --- Clonidine Overdose ---
  {
    protocol: "Pediatric Clonidine Overdose",
    id: "peds_clon_epi",
    name: "Epinephrine infusion",
    route: "IV infusion",
    tags: ["pressor"],
    calc(weightKg) {
      const low = 0.05 * weightKg;
      const high = 0.5 * weightKg;
      return `0.05–0.5 mcg/kg/min → ${low.toFixed(3)}–${high.toFixed(3)} mcg/min.`;
    },
    note: "For hypotension/bradycardia per protocol."
  },
  {
    protocol: "Pediatric Clonidine Overdose",
    id: "peds_clon_narcan_bolus",
    name: "Naloxone bolus",
    route: "IV push",
    tags: ["bolus"],
    calc() {
      return `10 mg IVP (fixed dose).`;
    },
    note: "One-time IVP dose for respiratory depression/AMS."
  },
  {
    protocol: "Pediatric Clonidine Overdose",
    id: "peds_clon_narcan_drip",
    name: "Naloxone infusion",
    route: "IV infusion",
    tags: ["infusion"],
    calc() {
      return `5 mg/hr infusion.`;
    },
    note: "After initial bolus when symptoms recur or persist."
  },
  {
    protocol: "Pediatric Clonidine Overdose",
    id: "peds_clon_ns_bolus",
    name: "Normal saline bolus",
    route: "IV",
    tags: ["bolus", "fluid"],
    calc(weightKg) {
      const mlPerKg = 20;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL (may repeat ×2 if no response).`;
    },
    note: "Initial volume expansion."
  },

  // --- DKA ---
  {
    protocol: "Pediatric DKA",
    id: "peds_dka_ns_bolus",
    name: "Normal saline bolus",
    route: "IV",
    tags: ["bolus", "fluid"],
    calc(weightKg) {
      const mlPerKg = 20;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL over 1 hr for uncompensated shock.`;
    },
    note: "Repeat based on perfusion and medical control."
  },
  {
    protocol: "Pediatric DKA",
    id: "peds_dka_insulin",
    name: "Insulin infusion",
    route: "IV infusion",
    tags: ["infusion"],
    calc(weightKg) {
      const unitsPerKgHr = 0.1;
      const unitsHr = weightKg * unitsPerKgHr;
      return `${unitsPerKgHr} unit/kg/hr → ${unitsHr.toFixed(2)} units/hr.`;
    },
    note: "Regular insulin; start after initial fluids and per protocol."
  },
  {
    protocol: "Pediatric DKA",
    id: "peds_dka_mivf_double",
    name: "MIVF rate (double 4–2–1)",
    route: "IV infusion",
    tags: ["maintenance", "DKA"],
    calc(weightKg) {
      const base = mivfRate(weightKg);
      const dbl = base * 2;
      const max = 200;
      const rate = Math.min(dbl, max);
      return `2 × (4–2–1) = ${dbl.toFixed(1)} mL/hr (capped at ${max} mL/hr → ${rate.toFixed(1)} mL/hr).`;
    },
    note: "DKA fluid protocol: maintenance rate doubled, with max 200 mL/hr."
  },

  // --- Fever Management ---
  {
    protocol: "Pediatric Fever Management",
    id: "peds_fever_ibuprofen",
    name: "Ibuprofen (Motrin)",
    route: "PO",
    tags: ["antipyretic"],
    calc(weightKg) {
      const mgPerKg = 10;
      const maxMg = 600;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg (max 600 mg).`;
    },
    note: "Avoid in patients <6 months or with listed contraindications."
  },
  {
    protocol: "Pediatric Fever Management",
    id: "peds_fever_tyl",
    name: "Acetaminophen (Tylenol)",
    route: "PO/PR",
    tags: ["antipyretic"],
    calc(weightKg) {
      const mgPerKg = 15;
      const maxMg = 650;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg (max 650 mg).`;
    },
    note: "Use unless contraindicated or given within last 6 hours."
  },

  // --- Hypoglycemia ---
  {
    protocol: "Pediatric Hypoglycemia",
    id: "peds_hypo_d10",
    name: "D10W bolus",
    route: "IV",
    tags: ["bolus", "glucose"],
    calc(weightKg) {
      const mlPerKg = 5;
      const max = 100;
      const vol = Math.min(weightKg * mlPerKg, max);
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL (max 100 mL).`;
    },
    note: "For blood glucose <60 mg/dL."
  },
  {
    protocol: "Pediatric Hypoglycemia",
    id: "peds_hypo_mivf",
    name: "Maintenance fluid (D5NS)",
    route: "IV infusion",
    tags: ["maintenance"],
    calc(weightKg) {
      const rate = mivfRate(weightKg);
      const max = 150;
      const adj = Math.min(rate, max);
      return `D5NS @ ${rate.toFixed(1)} mL/hr (capped at ${max} mL/hr → ${adj.toFixed(1)} mL/hr).`;
    },
    note: "4–2–1 rule; consult protocol for choice of D10W vs D5NS."
  },

  // --- NAT / Head Injury Hypertonic Saline ---
  {
    protocol: "Pediatric NAT / Head Trauma",
    id: "peds_nat_hts",
    name: "3% Hypertonic Saline (herniation signs)",
    route: "IV",
    tags: ["bolus", "hypertonic"],
    calc(weightKg) {
      const mlPerKg = 5;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL IV.`;
    },
    note: "Per NAT protocol when impending herniation (Cushing triad, etc.)."
  },

  // --- Pain Management ---
  {
    protocol: "Pediatric Pain Management",
    id: "peds_pain_morphine",
    name: "Morphine sulfate",
    route: "IV/IM",
    tags: ["analgesic"],
    calc(weightKg) {
      const low = 0.05 * weightKg;
      const high = 0.1 * weightKg;
      const maxMg = 4;
      const lowAdj = Math.min(low, maxMg);
      const highAdj = Math.min(high, maxMg);
      return `0.05–0.1 mg/kg → ${lowAdj.toFixed(3)}–${highAdj.toFixed(3)} mg (max 4 mg).`;
    },
    note: "Titrate to pain and vitals; monitor for respiratory depression."
  },
  {
    protocol: "Pediatric Pain Management",
    id: "peds_pain_fent",
    name: "Fentanyl",
    route: "IV/IN",
    tags: ["analgesic"],
    calc(weightKg) {
      const low = 1 * weightKg;
      const high = 2 * weightKg;
      const maxMcg = 100;
      const lowAdj = Math.min(low, maxMcg);
      const highAdj = Math.min(high, maxMcg);
      return `1–2 mcg/kg → ${lowAdj.toFixed(1)}–${highAdj.toFixed(1)} mcg (max 100 mcg).`;
    },
    note: "IV or IN per protocol."
  },
  {
    protocol: "Pediatric Pain Management",
    id: "peds_pain_ketamine",
    name: "Ketamine (rescue)",
    route: "IV",
    tags: ["analgesic", "sedation"],
    calc(weightKg) {
      const mgPerKg = 0.2;
      const mg = weightKg * mgPerKg;
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg.`;
    },
    note: "Only if morphine and fentanyl inadequate; contact medical control first."
  },
  {
    protocol: "Pediatric Pain Management",
    id: "peds_pain_zofran",
    name: "Ondansetron (Zofran)",
    route: "IV/PO",
    tags: ["antiemetic"],
    calc(weightKg) {
      const mgPerKg = 0.1;
      const maxMg = 4;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 4 mg).`;
    },
    note: "For nausea or patients receiving opioids."
  },

  // --- Sedation While Intubated ---
  {
    protocol: "Sedation While Intubated",
    id: "peds_sed_fent_lt40",
    name: "Fentanyl (≤40 kg)",
    route: "IV bolus + infusion",
    tags: ["sedation", "infusion"],
    calc(weightKg) {
      if (weightKg > 40) {
        return "Use >40 kg regimen: see separate entry.";
      }
      const load = 1 * weightKg;
      const inf = 1 * weightKg;
      return [
        `Loading: 1 mcg/kg q5 min ×2 → ${load.toFixed(1)} mcg each bolus.`,
        `Infusion: 1 mcg/kg/hr → ${inf.toFixed(1)} mcg/hr (max 5 mcg/kg/hr).`
      ].join(" ");
    },
    note: "Titrate by 1 mcg/kg/hr boluses & increments up to 5 mcg/kg/hr to meet RASS goal."
  },
  {
    protocol: "Sedation While Intubated",
    id: "peds_sed_fent_gt40",
    name: "Fentanyl (>40 kg)",
    route: "IV bolus + infusion",
    tags: ["sedation", "infusion"],
    calc(weightKg) {
      if (weightKg <= 40) {
        return "Use ≤40 kg regimen: see separate entry.";
      }
      return [
        "Loading: 50 mcg q5 min ×2.",
        "Infusion: 50 mcg/hr (max 200 mcg/hr),",
        "titrate by 50 mcg/hr based on RASS."
      ].join(" ");
    },
    note: "Weight >40 kg uses fixed mcg dosing."
  },
  {
    protocol: "Sedation While Intubated",
    id: "peds_sed_midazolam_prn",
    name: "Midazolam (PRN)",
    route: "IV",
    tags: ["sedation"],
    calc(weightKg) {
      const mgPerKg = 0.05;
      const maxMg = 5;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(3)} mg (max 5 mg) q2h PRN.`;
    },
    note: "Use if RASS above target and fentanyl already at bolus/infusion limits."
  },

  // --- Pediatric RSI ---
  {
    protocol: "Pediatric RSI",
    id: "peds_rsi_atropine",
    name: "Atropine (premed)",
    route: "IV",
    tags: ["premed"],
    calc(weightKg, ageYears) {
      const mgPerKg = 0.02;
      const mg = weightKg * mgPerKg;
      const noteAge = ageYears < 1 ? "" : " (protocol: <1 year only).";
      return `${mgPerKg} mg/kg → ${mg.toFixed(3)} mg${noteAge}`;
    },
    note: "Premedication for infants <1 year to prevent bradycardia."
  },
  {
    protocol: "Pediatric RSI",
    id: "peds_rsi_ketamine",
    name: "Ketamine (induction)",
    route: "IV",
    tags: ["induction"],
    calc(weightKg) {
      const mgPerKg = 2;
      const mg = weightKg * mgPerKg;
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg.`;
    },
    note: "Preferred induction agent in many peds RSI scenarios."
  },
  {
    protocol: "Pediatric RSI",
    id: "peds_rsi_fentanyl",
    name: "Fentanyl (induction adjunct)",
    route: "IV",
    tags: ["induction"],
    calc(weightKg) {
      const low = 1 * weightKg;
      const high = 2 * weightKg;
      return `1–2 mcg/kg → ${low.toFixed(1)}–${high.toFixed(1)} mcg.`;
    },
    note: "Analgesic/sympatholytic pre-induction."
  },
  {
    protocol: "Pediatric RSI",
    id: "peds_rsi_midazolam",
    name: "Midazolam (sedation)",
    route: "IV",
    tags: ["induction"],
    calc(weightKg) {
      const low = 0.1 * weightKg;
      const high = 0.3 * weightKg;
      const maxMg = 5;
      const lowAdj = Math.min(low, maxMg);
      const highAdj = Math.min(high, maxMg);
      return `0.1–0.3 mg/kg → ${lowAdj.toFixed(2)}–${highAdj.toFixed(2)} mg (max 5 mg).`;
    },
    note: "Sedative component of RSI."
  },
  {
    protocol: "Pediatric RSI",
    id: "peds_rsi_etomidate",
    name: "Etomidate",
    route: "IV",
    tags: ["induction"],
    calc(weightKg) {
      const mgPerKg = 0.3;
      const maxMg = 20;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 20 mg).`;
    },
    note: "Alternative induction agent."
  },
  {
    protocol: "Pediatric RSI",
    id: "peds_rsi_roc",
    name: "Rocuronium",
    route: "IV",
    tags: ["paralytic"],
    calc(weightKg) {
      const mgPerKg = 1;
      const mg = weightKg * mgPerKg;
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg.`;
    },
    note: "Neuromuscular blockade for RSI."
  },
  {
    protocol: "Pediatric RSI",
    id: "peds_rsi_vec",
    name: "Vecuronium (maintenance)",
    route: "IV",
    tags: ["paralytic"],
    calc(weightKg) {
      const mgPerKg = 0.1;
      const mg = weightKg * mgPerKg;
      return `${mgPerKg} mg/kg → ${mg.toFixed(3)} mg.`;
    },
    note: "Maintenance paralysis after intubation."
  },

  // --- Seizure ---
  {
    protocol: "Pediatric Seizure",
    id: "peds_sz_lorazepam",
    name: "Lorazepam (Ativan)",
    route: "IV",
    tags: ["benzodiazepine"],
    calc(weightKg) {
      const mgPerKg = 0.1;
      const maxMg = 2;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 2 mg per dose).`;
    },
    note: "May repeat q5 min ×3 as needed."
  },
  {
    protocol: "Pediatric Seizure",
    id: "peds_sz_midazolam",
    name: "Midazolam (Versed)",
    route: "IV",
    tags: ["benzodiazepine"],
    calc(weightKg) {
      const mgPerKg = 0.1;
      const maxMg = 2;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 2 mg per dose).`;
    },
    note: "May repeat q5 min ×3 as needed."
  },
  {
    protocol: "Pediatric Seizure",
    id: "peds_sz_keppra",
    name: "Levetiracetam (Keppra)",
    route: "IV",
    tags: ["antiseizure"],
    calc(weightKg) {
      const mgPerKg = 60;
      const mg = weightKg * mgPerKg;
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg over 20 min.`;
    },
    note: "Loading dose after benzodiazepines."
  },
  {
    protocol: "Pediatric Seizure",
    id: "peds_sz_fospheny",
    name: "Fosphenytoin",
    route: "IV infusion",
    tags: ["antiseizure"],
    calc(weightKg) {
      const mgPerKg = 20;
      const mg = weightKg * mgPerKg;
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg at 2 mg/min (max 150 mg/min).`;
    },
    note: "Second-line agent; monitor for hypotension and arrhythmias."
  },
  {
    protocol: "Pediatric Seizure",
    id: "peds_sz_hts",
    name: "3% Hypertonic Saline",
    route: "IV",
    tags: ["hypertonic"],
    calc(weightKg) {
      const mlPerKg = 3;
      const maxMl = 250;
      const vol = Math.min(weightKg * mlPerKg, maxMl);
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL (max 250 mL) when Na <130 & actively seizing.`;
    },
    note: "For hyponatremic seizures."
  },
  {
    protocol: "Pediatric Seizure",
    id: "peds_sz_d10",
    name: "D10W bolus",
    route: "IV",
    tags: ["glucose"],
    calc(weightKg) {
      const mlPerKg = 5;
      const maxMl = 100;
      const vol = Math.min(weightKg * mlPerKg, maxMl);
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL (max 100 mL) for BG <60 mg/dL.`;
    },
    note: "Treat hypoglycemia contributing to seizures."
  },

  // --- Shock ---
  {
    protocol: "Pediatric Shock",
    id: "peds_shock_ns",
    name: "Normal saline bolus",
    route: "IV",
    tags: ["bolus", "fluid"],
    calc(weightKg) {
      const mlPerKg = 20;
      const vol = weightKg * mlPerKg;
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL; may give up to 60 mL/kg.`;
    },
    note: "Rapid infusion; reassess perfusion each bolus."
  },
  {
    protocol: "Pediatric Shock",
    id: "peds_shock_mivf",
    name: "Maintenance fluids",
    route: "IV infusion",
    tags: ["maintenance"],
    calc(weightKg) {
      const rate = mivfRate(weightKg);
      const max = 150;
      const adj = Math.min(rate, max);
      return `Rate = ${rate.toFixed(1)} mL/hr (capped at ${max} mL/hr → ${adj.toFixed(1)} mL/hr).`;
    },
    note: "Standard 4–2–1 rule."
  },
  {
    protocol: "Pediatric Shock",
    id: "peds_shock_dopamine",
    name: "Dopamine infusion",
    route: "IV infusion",
    tags: ["pressor"],
    calc(weightKg) {
      const low = 5 * weightKg;
      const high = 10 * weightKg;
      return `5–10 mcg/kg/min → ${low.toFixed(1)}–${high.toFixed(1)} mcg/min.`;
    },
    note: "First-line inotrope/pressor per protocol."
  },
  {
    protocol: "Pediatric Shock",
    id: "peds_shock_epi",
    name: "Epinephrine infusion",
    route: "IV infusion",
    tags: ["pressor"],
    calc(weightKg) {
      const low = 0.05 * weightKg;
      const high = 0.5 * weightKg;
      return `0.05–0.5 mcg/kg/min → ${low.toFixed(3)}–${high.toFixed(3)} mcg/min.`;
    },
    note: "For distributive or cardiogenic shock as directed."
  },
  {
    protocol: "Pediatric Shock",
    id: "peds_shock_alpro",
    name: "Alprostadil (PGE1)",
    route: "IV infusion",
    tags: ["ductal-dependent CHD"],
    calc(weightKg) {
      const mcgPerKgMin = 0.05;
      const mcgMin = weightKg * mcgPerKgMin;
      return `${mcgPerKgMin} mcg/kg/min → ${mcgMin.toFixed(3)} mcg/min.`;
    },
    note: "For neonates <14 days in suspected ductal-dependent shock."
  },
  {
    protocol: "Pediatric Shock",
    id: "peds_shock_norepi",
    name: "Norepinephrine",
    route: "IV infusion",
    tags: ["pressor"],
    calc() {
      return "Dose per medical control (not specified numerically in protocol).";
    },
    note: "Consider in low SVR/cold shock per physician order."
  },

  // --- Toxic Ingestion ---
  {
    protocol: "Pediatric Toxic Ingestion",
    id: "peds_tox_versed",
    name: "Midazolam (Versed)",
    route: "IV",
    tags: ["sedation"],
    calc(weightKg) {
      const low = 0.05 * weightKg;
      const high = 0.1 * weightKg;
      return `0.05–0.1 mg/kg → ${low.toFixed(3)}–${high.toFixed(3)} mg.`;
    },
    note: "PRN for agitation related to toxic ingestion."
  },
  {
    protocol: "Pediatric Toxic Ingestion",
    id: "peds_tox_d10",
    name: "D10W bolus",
    route: "IV",
    tags: ["glucose"],
    calc(weightKg) {
      const mlPerKg = 5;
      const max = 100;
      const vol = Math.min(weightKg * mlPerKg, max);
      return `${mlPerKg} mL/kg → ${vol.toFixed(1)} mL (max 100 mL) for BG <60 mg/dL.`;
    },
    note: "Treats hypoglycemia in overdose setting."
  },

  // --- Tricyclic OD ---
  {
    protocol: "Pediatric Tricyclic Overdose",
    id: "peds_tca_bicarb",
    name: "Sodium bicarbonate",
    route: "IV push",
    tags: ["alkalinization"],
    calc(weightKg) {
      const low = 1 * weightKg;
      const high = 2 * weightKg;
      const maxMeq = 50;
      const lowAdj = Math.min(low, maxMeq);
      const highAdj = Math.min(high, maxMeq);
      return `1–2 mEq/kg → ${lowAdj.toFixed(1)}–${highAdj.toFixed(1)} mEq (max 50 mEq).`;
    },
    note: "Rapid IV push for QRS/QTc prolongation."
  },
  {
    protocol: "Pediatric Tricyclic Overdose",
    id: "peds_tca_mag",
    name: "Magnesium sulfate",
    route: "IV",
    tags: ["antiarrhythmic"],
    calc(weightKg) {
      const mgPerKg = 25;
      const maxMg = 2000;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      const grams = mg / 1000;
      return `${mgPerKg} mg/kg → ${mg.toFixed(1)} mg (≈ ${grams.toFixed(2)} g, max 2 g).`;
    },
    note: "For refractory prolonged QRS/QTc despite bicarbonate."
  },
  {
    protocol: "Pediatric Tricyclic Overdose",
    id: "peds_tca_lorazepam",
    name: "Lorazepam (Ativan)",
    route: "IV",
    tags: ["benzodiazepine"],
    calc(weightKg) {
      const mgPerKg = 0.1;
      const maxMg = 2;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 2 mg).`;
    },
    note: "For seizures related to tricyclic overdose."
  },
  {
    protocol: "Pediatric Tricyclic Overdose",
    id: "peds_tca_mivf",
    name: "Maintenance infusion",
    route: "IV infusion",
    tags: ["maintenance"],
    calc(weightKg) {
      const rate = mivfRate(weightKg);
      const max = 150;
      const adj = Math.min(rate, max);
      return `Rate = ${rate.toFixed(1)} mL/hr (max ${max} → ${adj.toFixed(1)} mL/hr).`;
    },
    note: "Standard fluid maintenance during treatment."
  },

  // --- Upper Airway Respiratory Distress ---
  {
    protocol: "Pediatric Upper Airway Distress",
    id: "peds_ua_racemic",
    name: "Racemic epinephrine",
    route: "Nebulized",
    tags: ["nebulized"],
    calc() {
      return `11.25 mg nebulized (fixed dose).`;
    },
    note: "For stridor and upper airway obstruction."
  },
  {
    protocol: "Pediatric Upper Airway Distress",
    id: "peds_ua_dexa",
    name: "Dexamethasone (Decadron)",
    route: "IV/PO",
    tags: ["steroid"],
    calc(weightKg) {
      const mgPerKg = 0.6;
      const maxMg = 16;
      const mg = Math.min(weightKg * mgPerKg, maxMg);
      return `${mgPerKg} mg/kg → ${mg.toFixed(2)} mg (max 16 mg).`;
    },
    note: "Give steroid and consider repeat racemic epinephrine as needed."
  }
];

// initialize protocol filter options
(function initProtocolFilter() {
  const select = document.getElementById("protocolFilter");
  const uniqueProtocols = [...new Set(drugs.map(d => d.protocol))].sort();
  uniqueProtocols.forEach(p => {
    const opt = document.createElement("option");
    opt.value = p;
    opt.textContent = p;
    select.appendChild(opt);
  });
})();

function calculateDoses() {
  const weightInput = document.getElementById("weightKg");
  const ageInput = document.getElementById("ageYears");
  const protocolFilter = document.getElementById("protocolFilter").value;
  const tbody = document.getElementById("resultsBody");
  const summary = document.getElementById("summary");

  const weightKg = parseFloat(weightInput.value);
  const ageYears = parseFloat(ageInput.value) || 0;

  if (isNaN(weightKg) || weightKg <= 0) {
    alert("Please enter a valid weight in kilograms.");
    return;
  }

  tbody.innerHTML = "";
  let shown = 0;

  drugs
    .filter(d => protocolFilter === "all" || d.protocol === protocolFilter)
    .forEach(drug => {
      let doseText;
      try {
        doseText = drug.calc(weightKg, ageYears);
      } catch (e) {
        doseText = "Error calculating dose.";
      }

      const tr = document.createElement("tr");

      const tdProtocol = document.createElement("td");
      tdProtocol.innerHTML = `<span class="protocol">${drug.protocol}</span>`;
      tr.appendChild(tdProtocol);

      const tdDrug = document.createElement("td");
      tdDrug.innerHTML =
        `<div class="drug-name">${drug.name}</div>` +
        `<div class="muted">${drug.route}</div>`;
      tr.appendChild(tdDrug);

      const tdDose = document.createElement("td");
      tdDose.textContent = doseText;
      tr.appendChild(tdDose);

      const tdNotes = document.createElement("td");
      const tagsHtml = (drug.tags || [])
        .map(t => `<span class="chip">${t}</span>`)
        .join(" ");
      tdNotes.innerHTML = `${tagsHtml} <span class="note">${drug.note || ""}</span>`;
      tr.appendChild(tdNotes);

      tbody.appendChild(tr);
      shown++;
    });

  summary.textContent =
    `Weight: ${weightKg.toFixed(2)} kg · Age: ${ageYears.toFixed(1)} year(s) · ` +
    `${shown} entries shown (${protocolFilter === "all" ? "all protocols" : protocolFilter}).`;
}

// initial run
calculateDoses();
</script>
</body>
</html>
